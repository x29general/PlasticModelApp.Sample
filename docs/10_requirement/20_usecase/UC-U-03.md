# UC-U-03: 塗料検索（画像アップロード）

ユーザーが画像をアップロードして、その画像から色を抽出し、その色に近い塗料を検索できるようにする。

## 1. アクター

- 一般ユーザー（ログイン/非ログイン）※以下、「ユーザー」とする。

## 2. 事前条件

- ユーザーがアプリケーションにアクセスできる状態であること。

## 3. 主シナリオ

1. ユーザーが塗料検索ページにアクセスする。
2. ユーザーが画像をアップロードする。
3. システムが、アップロードされた画像を表示する。
4. ユーザーが、アップロードされた画像をクリックする。
5. システムが、クリックされた位置の色を抽出し、その色のプレビューを表示する。
6. ユーザーが、閾値を設定する。
7. ユーザーが「検索」ボタンをクリックする。
8. システムが、抽出された色に近い塗料を表示する。
9. ユーザーは任意で、「次へ」「前へ」ボタンでページ移動ができる。

1ページの表示件数:

- 30件

## 4. 代替シナリオ

### 4.1. 画像がアップロードされない場合

1. ユーザーが塗料検索ページにアクセスする。
2. ユーザーが画像をアップロードしない。
3. システムが、検索ボタンを非活性化する。
4. ユーザーが「検索」ボタンをクリックできない。

### 4.2. 抽出された色がない場合

1. ユーザーが塗料検索ページにアクセスする。
2. ユーザーが画像をアップロードする。
3. システムが、アップロードされた画像を表示する。
4. ユーザーが、アップロードされた画像をクリックする。
5. システムが、クリックされた位置の色を抽出する。
6. システムが、抽出された色がないことを検出する。
7. システムが、「色を抽出できませんでした」というメッセージを表示する。
8. ユーザーは、再度画像をアップロードするか、カラーピッカーを使用して色を選択することができる。

### 4.3. 検索結果が0件の場合

1. ユーザーが塗料検索ページにアクセスする。
2. ユーザーが画像をアップロードする。
3. システムが、アップロードされた画像を表示する。
4. ユーザーが、アップロードされた画像をクリックする。
5. システムが、クリックされた位置の色を抽出する。
6. ユーザーが、閾値を設定する。
7. ユーザーが「検索」ボタンをクリックする。
8. システムは「該当する塗料が見つかりませんでした」というメッセージを表示する。

## 5. 例外シナリオ

1. ユーザーが塗料検索ページにアクセスする。
2. ユーザーが画像をアップロードする。
3. システムが、アップロードされた画像を表示する。
4. ユーザーが、アップロードされた画像をクリックする。
5. システムが、クリックされた位置の色を抽出する。
6. ユーザーが、閾値を設定する。
7. ユーザーが「検索」ボタンをクリックする。
8. システムはエラーメッセージを表示する。

エラーハンドリング:

- ユーザーが無効な画像をアップロードした場合
- ユーザーが無効な閾値を設定した場合
- システムの内部エラーが発生した場合

## 6. その他の仕様

### 6.1. 色の類似度

- 色の類似度は、ユーザーがクリックした位置の色と塗料の色の距離を計算して評価されます。
- ユーザーが設定した閾値は、色の類似度の評価に使用されます。
- 類似度の評価方法は、UC-U-02と同様です。

### 6.2. 画像のアップロード

- ユーザーは、JPEG、PNG形式の画像をアップロードできます。
- アップロードされた画像は、サーバーに保存されず、一時的に処理されます。
- 画像の最大サイズは5MBとします。

### 6.3. 色の抽出

- ユーザーがクリックした位置の色は、RGB形式で抽出されます。
- 抽出された色は、検索に使用される前に、必要に応じてHSV形式などの他の色空間に変換されることがあります。
- 色の抽出は、画像処理ライブラリを使用して行われます。
